ch15 平衡搜索树

平衡搜索树：
在保持二叉搜索树有序性的同时，通过额外的规则和调整，使树的高度始终保持在 O(log n) 级别的搜索树

平衡搜索树的目标
防止退化，让树“不要歪”


| 树     | 平衡方式 | 优点    | 缺点   |
| ----- | ---- | ----- | ---- |
| AVL   | 高度差  | 查找最快  | 插删慢  |
| 红黑树   | 颜色   | 插删稳定  | 查找略慢 |
| Treap | 随机   | 实现简单  | 非确定性 |
| Splay | 自调整  | 局部性强  | 单次最坏 |
| B+ 树  | 多路   | IO 最少 | 复杂   |


AVL 和 红黑树适用于内部储存， B- 树适合 外部应用储存



 AVL 树（最严格的平衡搜索树）
AVL 树 是一种 高度严格受限的二叉搜索树：
对任意结点：
左子树高度 − 右子树高度 ∈ {−1, 0, 1}

| 失衡类型 | 说明        | 旋转方式    |
| ---- | --------- | ------- |
| LL   | 左子树的左孩子过高 | 右旋      |
| RR   | 右子树的右孩子过高 | 左旋      |
| LR   | 左子树的右孩子过高 | 左旋 + 右旋 |
| RL   | 右子树的左孩子过高 | 右旋 + 左旋 |

使用场景
读多写少
对查找性能要求极高


| 操作   | 核心目标      | 基本思路                             | 关键点               |
| ---- | --------- | -------------------------------- | ----------------- |
| 查找   | 利用有序性     | 和普通 BST 一样，比较大小向左 / 右走           | 不涉及旋转             |
| 插入   | 插入后保持高度平衡 | 先按 BST 插入，再**自底向上更新高度**          | 发现失衡就旋转           |
| 删除   | 删除后恢复平衡   | 按 BST 删除，再回溯检查平衡                 | 可能多次旋转            |
| 平衡维护 | 控制高度差     | 计算平衡因子 `bf = h(left) - h(right)` | `bf ∈ {-1,0,1}`   |
| 失衡修复 | 恢复 AVL 条件 | 根据失衡类型旋转                         | LL / RR / LR / RL |
| 查最值  | 找极值       | 一直向左 / 右                         | `O(h)`            |

.






红黑树（工业界最常用）
红黑树是一种 近似平衡的二叉搜索树，通过 颜色规则 控制高度：

🔴⚫ 五条红黑规则（必考）
每个结点非红即黑
根结点是黑色
红结点不能有红孩子
任意结点到叶子路径上的 黑结点数相同（黑高）
空结点（NIL）视为黑色

🔧 平衡方式
变色
少量旋转（通常 ≤ 2 次）

⚡ 性能
查找：略慢于 AVL
插入 / 删除：非常稳定

使用场景
STL map / set
操作系统、数据库索引

| 操作   | 核心目标      | 基本思路           | 关键点            |
| ---- | --------- | -------------- | -------------- |
| 查找   | 利用有序性     | 和 BST 一样       | 不关心颜色          |
| 插入   | 插入后保持红黑规则 | 新结点先染 **红色**   | 避免破坏黑高         |
| 插入修复 | 修复红红冲突    | 通过 **变色 + 旋转** | 父 / 叔颜色判断      |
| 删除   | 删除结点      | 转化为删除叶子        | 复杂但规则固定        |
| 删除修复 | 修复黑高      | 引入“双重黑”概念      | 兄弟结点分析         |
| 平衡维护 | 控制树高      | 不严格平衡          | 高度 ≤ `2log(n)` |

.






B 树 / B+ 树（多路平衡树）
B 树 是一种 多路平衡搜索树：
一个结点可以有 多个 key
所有叶子在同一层

| 对比   | B 树      | B+ 树          |
| ---- | -------- | ------------- |
| 数据存储 | 内部结点也存数据 | **只在叶子结点存数据** |
| 叶子结点 | 无链表      | **有链表**       |
| 范围查询 | 一般       | **非常高效**      |

⚡ 性能
高度极低（磁盘友好）
IO 次数最少
📌 使用场景
数据库索引
文件系统（NTFS / ext4）

| 操作   | 核心目标          | 基本思路           | 关键点        |
| ---- | ------------- | -------------- | ---------- |
| 查找   | 减少 IO 次数      | 在结点内顺序 / 二分查找  | 一次访问多个 key |
| 插入   | 保持结点有序且不溢出    | 先插入叶子          | 可能向上分裂     |
| 结点分裂 | 处理 key 过多     | 中间 key 上移      | 树高可能 +1    |
| 删除   | 删除 key 后不低于下限 | 优先向兄弟借         | 借不到就合并     |
| 结点合并 | 修复 key 过少     | 和兄弟 + 父 key 合并 | 树高可能 −1    |
| 平衡维护 | 所有叶子同层        | 通过分裂 / 合并      | 无旋转操作      |

.
